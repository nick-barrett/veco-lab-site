---
apiVersion: v1
kind: Namespace
metadata:
  name: metallb-system
  labels:
    pod-security.kubernetes.io/enforce: privileged
    pod-security.kubernetes.io/audit: privileged
    pod-security.kubernetes.io/warn: privileged
#---
#apiVersion: v1
#kind: Namespace
#metadata:
#  name: ingress-controller
---
apiVersion: v1
kind: Namespace
metadata:
  name: flux-user
#---
#apiVersion: source.toolkit.fluxcd.io/v1
#kind: GitRepository
#metadata:
#  name: k8s-gateway-api
#  namespace: flux-user
#spec:
#  interval: 12h
#  url: https://github.com/kubernetes-sigs/gateway-api
#  ref:
#    tag: v1.0.0
---
#apiVersion: kustomize.toolkit.fluxcd.io/v1
#kind: Kustomization
#metadata:
#  name: k8s-gateway-api-extension
#  namespace: flux-user
#spec:
#  interval: 12h
#  sourceRef:
#    kind: GitRepository
#    name: k8s-gateway-api
#    namespace: flux-user
#  path: "./config/crd"
#  prune: true
#---
apiVersion: kustomize.toolkit.fluxcd.io/v1
kind: Kustomization
metadata:
  name: infra-services
  namespace: flux-user
spec:
  interval: 1m0s
  sourceRef:
    kind: GitRepository
    name: flux-system
    namespace: flux-system
  path: "./infra-services"
  prune: true
  timeout: 1m0s
  dependsOn:
    - name: k8s-gateway-api-extension
---
apiVersion: kustomize.toolkit.fluxcd.io/v1
kind: Kustomization
metadata:
  name: infra-cfg
  namespace: flux-user
spec:
  interval: 5m0s
  sourceRef:
    kind: GitRepository
    name: flux-system
    namespace: flux-system
  path: "./infra-cfg"
  prune: true
  timeout: 1m0s
  dependsOn:
    - name: infra-services
---
apiVersion: kustomize.toolkit.fluxcd.io/v1
kind: Kustomization
metadata:
  name: apps
  namespace: flux-user
spec:
  interval: 1m0s
  sourceRef:
    kind: GitRepository
    name: flux-system
    namespace: flux-system
  path: "./apps"
  prune: true
  timeout: 1m0s
  dependsOn:
    - name: infra-cfg
---
apiVersion: kustomize.toolkit.fluxcd.io/v1
kind: Kustomization
metadata:
  name: vms
  namespace: flux-user
spec:
  interval: 1m0s
  sourceRef:
    kind: GitRepository
    name: flux-system
    namespace: flux-system
  path: "./vms"
  prune: true
  timeout: 1m0s
